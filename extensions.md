# 7. 扩展（未校对）

协议强制规定接收方必须识别并忽略掉所有未知帧类型的帧。双方必须在逐跳原则（hop-by-hop basis）基础上协商新的帧，这些帧的状态无法被改变，并且也不受流控制。

制定http2协议的时候，是否应该允许添加扩展的这个话题被反复讨论了很久。在draft-12之后，结果最终定格 - 扩展再次被允许添加。

扩展不再是协议本身的一部分，而是被记录在核心协议规范之外。到目前为止，有两种曾被http2工作组包含在协议里的帧，很可能率先被纳入协议的扩展部分。<!-- 这句话我觉得我本来翻译是错的，应该是现在这个意思才对-->这两个曾被当作“原生”的帧非常流行，所以接下来我会详细讨论它们。

**7.1. 备选服务**

随着http2逐渐被接受，有理由猜测，相对于HTTP 1.x，TCP连接被保持的更久。从客户端到每个主机/站点只需要一条单独的连接即可，并且每个连接也可能被保持开启更长的时间。

这会影响到HTTP负载均衡器的正常工作，也可能在一个网站想建议客户端连接到另外一个主机的时候引起问题。通常，网站此举的目的在照顾性能，也可能是正常维护或类似原因。<!-- 这一句话我理解到意思了，但是很难翻译出来。意思是负载均衡是在照顾性能，而网站想建议客户端连接到另外一个主机，很可能是在维护。-->

服务器将会通过发送Alt-Svc头（或者http2的ALTSVC帧）通知客户端备选服务。即另外一条获取同样内容的路由，但它指向不同的服务源，主机和端口。

客户端可以尝试异步的连接到服务，或者可能的话，使用备选服务。<!-- 这一句话要多考虑考虑，我也没有太理解到意思-->

**7.1.1. 机会型（Opportunistic）TLS**

Alt-Svc头部允许服务器通过*http://*告诉客户端：同样的内容也可以通过TLS连接来获取。

这是个还在讨论中的功能。这样的连接会导致未认证的TLS，并且在任何地方也不会被广播为“安全”，同时不会在客户端界面上出现任何锁标识，所以没法让用户知道这其实不是常规的HTTP连接。这就是很多人强烈反对机会型TLS。

**7.2. 阻塞**

当有数据需要被发送，但流控制却禁止发送任何数据时，此类型的帧将会被发送**仅**一次。这种帧设计的目的在于，如果某种实现收到了此帧，那么这种实现中必然有错或者是得到了低于期望的传输速度。

在此帧被放到协议扩展部分之前，draft-12中的一段话：

> 阻塞帧被包含在此版本的草案中作为实验，如果没有得到良好的反馈，就把它删除。
